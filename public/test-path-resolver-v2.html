<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تست Path Resolver V2 - زیتو</title>
</head>
<body>
    <!-- بارگذاری path-resolver جدید -->
    <script src="/xi2.ir/src/assets/js/path-resolver.js"></script>
    
    <div style="max-width: 800px; margin: 50px auto; padding: 30px; font-family: Arial; direction: rtl;">
        <h1 style="color: #333; text-align: center;">🧪 تست Path Resolver V2</h1>
        
        <div id="status" style="padding: 20px; margin: 20px 0; border-radius: 8px; background: #f8f9fa;">
            <h3>وضعیت DOM:</h3>
            <p id="domStatus">در حال بررسی...</p>
        </div>
        
        <div id="results" style="padding: 20px; margin: 20px 0; border-radius: 8px; background: #e7f3ff;">
            <h3>نتایج تست:</h3>
            <ul id="testResults"></ul>
        </div>
        
        <div id="console" style="padding: 20px; margin: 20px 0; border-radius: 8px; background: #f5f5f5; font-family: monospace; font-size: 12px;">
            <h3>Console Log:</h3>
            <div id="consoleOutput"></div>
        </div>
    </div>
    
    <script>
        // Override console.log to capture output
        var consoleOutput = document.getElementById('consoleOutput');
        var originalLog = console.log;
        var originalWarn = console.warn;
        var originalError = console.error;
        
        function addToConsole(type, message) {
            var p = document.createElement('p');
            p.style.margin = '2px 0';
            p.style.color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'green';
            p.textContent = '[' + type.toUpperCase() + '] ' + message;
            consoleOutput.appendChild(p);
        }
        
        console.log = function() {
            originalLog.apply(console, arguments);
            addToConsole('log', Array.prototype.join.call(arguments, ' '));
        };
        
        console.warn = function() {
            originalWarn.apply(console, arguments);
            addToConsole('warn', Array.prototype.join.call(arguments, ' '));
        };
        
        console.error = function() {
            originalError.apply(console, arguments);
            addToConsole('error', Array.prototype.join.call(arguments, ' '));
        };
        
        // DOM Status
        function updateDOMStatus() {
            var status = document.getElementById('domStatus');
            status.innerHTML = `
                <strong>Ready State:</strong> ${document.readyState}<br>
                <strong>Head:</strong> ${document.head ? '✅ موجود' : '❌ null'}<br>
                <strong>Body:</strong> ${document.body ? '✅ موجود' : '❌ null'}<br>
                <strong>Timestamp:</strong> ${new Date().toLocaleString('fa-IR')}
            `;
        }
        
        // Test Results
        function runTests() {
            var results = document.getElementById('testResults');
            var tests = [];
            
            // Test 1: Global Variable
            if (window.XI_BASE_URL !== undefined) {
                tests.push('✅ متغیر گلوبال XI_BASE_URL: ' + window.XI_BASE_URL);
            } else {
                tests.push('❌ متغیر گلوبال XI_BASE_URL موجود نیست');
            }
            
            // Test 2: Meta Tag
            var metaTag = document.querySelector('meta[name="xi-path-resolver"]');
            if (metaTag) {
                tests.push('✅ متا تگ موجود، نسخه: ' + metaTag.content);
            } else {
                tests.push('❌ متا تگ xi-path-resolver موجود نیست');
            }
            
            // Test 3: Font Styles
            var fontStyle = document.getElementById('xi2-path-resolver-fonts');
            if (fontStyle) {
                tests.push('✅ استایل فونت‌ها اضافه شده');
            } else {
                tests.push('❌ استایل فونت‌ها اضافه نشده');
            }
            
            // Test 4: CSS Files Count
            var cssCount = 0;
            var links = document.getElementsByTagName('link');
            for (var i = 0; i < links.length; i++) {
                if (links[i].href && links[i].href.indexOf('/src/assets/css/') !== -1) {
                    cssCount++;
                }
            }
            tests.push((cssCount > 0 ? '✅' : '❌') + ' فایل‌های CSS: ' + cssCount + ' فایل');
            
            // Test 5: JS Files Count
            var jsCount = 0;
            var scripts = document.getElementsByTagName('script');
            for (var j = 0; j < scripts.length; j++) {
                if (scripts[j].src && scripts[j].src.indexOf('/src/assets/js/') !== -1) {
                    jsCount++;
                }
            }
            tests.push((jsCount > 0 ? '✅' : '❌') + ' فایل‌های JS: ' + jsCount + ' فایل');
            
            // Test 6: Duplicate Prevention
            if (window.Xi2PathResolver === true) {
                tests.push('✅ جلوگیری از اجرای مکرر فعال است');
            } else {
                tests.push('❌ جلوگیری از اجرای مکرر کار نمی‌کند');
            }
            
            // Display results
            results.innerHTML = '';
            tests.forEach(function(test) {
                var li = document.createElement('li');
                li.style.margin = '8px 0';
                li.innerHTML = test;
                results.appendChild(li);
            });
        }
        
        // Initial status
        updateDOMStatus();
        
        // Run tests after a delay
        setTimeout(function() {
            updateDOMStatus();
            runTests();
        }, 2000);
        
        // Monitor DOM changes
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded fired');
            updateDOMStatus();
        });
        
        window.addEventListener('load', function() {
            console.log('Window load fired');
            updateDOMStatus();
            setTimeout(runTests, 500);
        });
        
        console.log('Test script initialized');
    </script>
</body>
</html>
